<!DOCTYPE html>
<html lang="fr" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M3U Playlist</title>
 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://vjs.zencdn.net/8.16.1/video-js.min.cs" rel="stylesheet">
  <link href="https://vsalema.github.io/tvpt4/css/tresmin.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.11.4/video.min.js"></script>
  <script src="https://vsalema.github.io/play3/js/open52.js"></script>
  <style>
  body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      color: #fff;
      display: flex;
      min-height: 100vh;
    }
 
  .mb-5 {
  margin-bottom: 1rem !important;
}

.input-group2 {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: stretch;
  width: 100%;
}
  
  .container, .container-fluid, .container-lg, .container-md, .container-sm, .container-xl, .container-xxl {
  --bs-gutter-x: 1.5rem;
  --bs-gutter-y: 0;
  width: 25%;
  padding-right: calc(var(--bs-gutter-x) * .5);
  padding-left: calc(var(--bs-gutter-x) * .5);
  margin-right: auto;
  margin-left: auto;
}
  
  .video-js {
  top: -50px;
  width: 100%;
  max-width: 1200px;
  
  border-radius: 10px;
  margin-left: 26px;
}
 .video-js {
  background-color: #000;
  box-sizing: border-box;
  display: block;
  color: #fff;
  line-height: normal;
  outline: 0;
  position: relative;
  padding: 0;
  overflow: hidden;
  vertical-align: top;
  font-family: Arial,sans-serif !important;
  font-size: 14px;
  user-select: none;
  -webkit-tap-highlight-color: transparent !important;
} 
  @media (min-width: 1200px) {
  .h1, h1 {
    font-size: 1.5rem;
  }
}
 .input-group {
 font-size: 11px;
} 
  
  #videoPlayer {
    height: 100vh;
    width: 100%;
    background-color: #000;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}
  .video-js .vjs-tech {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
  
  </style>
  <style>
 
 @media (min-width: 1200px) {
.dix {
  position: static;
  margin-top: 50px;
  width: 285px;
  height: 151px;
  padding: 1em;
  border: 1px solid rgba(255,255,255,.5);
  border-radius: 10px;
  box-sizing: border-box;
  background: rgba(255,255,255,.2);
  font: 150%/1.6 sans-serif;
  text-align: center;
  box-shadow: -1px -1px 10px rgba(255,255,255,.3) inset, 2px 2px 20px rgba(0,0,0,.5);
  text-shadow: 0 1px 1px rgba(255,255,255,.6);
}
 }
.dix:after {
	content: '';
	position: absolute;
	top: 0; right: 0; bottom: 0; left: 0;
	z-index: -1;
	border-radius:inherit;
	-webkit-filter: blur(3px);
}
  .tmd {
  max-width: 150px;
  max-height: 100px;
  width: 100%;
  height: 100%;
}
  
  </style>
  
  
  </head>

<body>
  <div class="container">
    <h1 class="mb-3 text-center">M3U Playlist</h1>

    <div class="input-group mb-3">
      <select id="sourceSelect" class="form-select">
        <option value="https://vsalema.github.io/tvpt4/css/movies.m3u">Movies</option>
        <option value="https://tvradiozap.eu/index.php/s/tvzeu.m3u">europe</option>
        <option value="https://iptv-org.github.io/iptv/index.m3u">iptv Monde</option>
        <option value="https://tvradiozap.eu/index.php/s/tvrzra.m3u">Radio</option>
        <option value="https://iptv-org.github.io/iptv/index.country.m3u">country</option>
        <option value="https://iptv-org.github.io/iptv/index.language.m3u">language</option>
        <option value="custom">Possibilit√©s</option>
      </select>

      <input type="text" id="m3uLink" class="form-control w-50" placeholder="Entrez le chemin M3U">
    </div>

    <div class="input-group mb-3">
      <input type="file" id="fileInput" class="form-control">
    </div>

    <div class=" input-group">
      <label for="categorySelect" class="form-label text-center w-50 ">S√©lectionnez la cat√©gorie:</label>
      <span class="form-label text-center w-50">S√©lectionnez la cha√Æne:</span>
    </div>

    <div class="input-group mb-3">
      <select id="categorySelect" class="form-select"></select>
      <select id="channelSelect" class="form-select"></select>
    </div>

    <div class="input-group mb-3">
      <input type="text" id="channelLink" class="form-control" placeholder="Lien de cha√Æne">
    </div>

   <div class="dix">
    <div class="input-group2 mb-5">
      <img id="channelLogo" src="" alt="Logo cha√Æneüì∫" class="tmd d-block mx-auto" style="max-width:150px;max-height:100px;">
    </div>
  
  
  </div></div>
   

    <div id="videoPlayerContainer" class="input-group2 mt-5">
      <video id="videoPlayer" class="js-video video-js  vjs-big-play-centered" autoplay playsinline  controls preload="auto" poster="https://cdn.futura-sciences.com/cdn-cgi/image/width=1920,quality=50,format=auto/sources/images/iptv.jpeg" data-setup="{}">
        <source src="" type="application/x-mpegURL">
      </video>
    </div>
  

  <script>
    const sourceSelect = document.getElementById("sourceSelect");
    const m3uLinkInput = document.getElementById("m3uLink");
    const channelLinkInput = document.getElementById("channelLink");
    const categorySelect = document.getElementById("categorySelect");
    const channelSelect = document.getElementById("channelSelect");
    const channelLogo = document.getElementById("channelLogo");
    const fileInput = document.getElementById("fileInput");
    const videoPlayer = videojs("videoPlayer");
    let data = "";
    let channels = [];
    const parseM3U = (m3uContent) => {
      const lines = m3uContent.split("\n");
      let currentChannel = {};
      let currentCategory = "";
      lines.forEach(line => {
        if (line.startsWith("#EXTGRP:")) {
          currentCategory = line.split(":")[1];
        } else if (line.startsWith("#EXTINF:")) {
          currentChannel = {};
          const lastCommaIndex = line.lastIndexOf(",");
          currentChannel.name = line.slice(lastCommaIndex + 1);
          const groupTitleMatch = line.match(/group-title="([^"]*)"/);
          const logoMatch = line.match(/tvg-logo="([^"]*)"/);
          
         
          
          if (groupTitleMatch) {
            currentChannel.category = groupTitleMatch[1];
          } else {
            currentChannel.category = currentCategory || "Unknown";
          }
          currentChannel.logo = logoMatch ? logoMatch[1] : "";
        } else if (line.startsWith("http")) {
          currentChannel.url = line;
          channels.push(currentChannel);
        }
      });
      return channels;
    };
    sourceSelect.addEventListener("change", () => {
      const selectedValue = sourceSelect.value;
      if (selectedValue === "custom") {
        m3uLinkInput.style.display = "block";
      } else {
        m3uLinkInput.style.display = "none";
        m3uLinkInput.value = selectedValue;
        fetchM3U();
      }
    });
    m3uLinkInput.addEventListener("input", fetchM3U);
    categorySelect.addEventListener("change", () => {
      updateChannelSelect();
    });
    channelSelect.addEventListener("change", () => {
      updateChannelLinkInput();
      playChannel();
    });
    fileInput.addEventListener("change", handleFileUpload);

    function fetchM3U() {
      clearData();
      const m3uLink = m3uLinkInput.value;
      if (m3uLink) {
        fetch(m3uLink)
          .then(response => response.text())
          .then(content => {
            data = content;
            channels = parseM3U(data);
            const categories = Array.from(new Set(channels.map(channel => channel.category)));
            categories.forEach(category => {
              const option = document.createElement("option");
              option.value = category;
              option.textContent = `${category} (${countChannelsInCategory(category)})`;
              categorySelect.appendChild(option);
            });
            updateChannelSelect();
          });
      }
    }

    function updateChannelSelect() {
      const selectedCategory = categorySelect.value;
      channelSelect.innerHTML = "";
      channels.filter(channel => channel.category === selectedCategory).forEach(channel => {
        const option = document.createElement("option");
        option.value = channel.url;
        option.textContent = channel.name;
        channelSelect.appendChild(option);
      });
      updateChannelLinkInput();
      playChannel();
    }

    function updateChannelLinkInput() {
      channelLinkInput.value = channelSelect.value;
    }

    function clearData() {
      data = "";
      channels = [];
      categorySelect.innerHTML = "";
      channelSelect.innerHTML = "";
      channelLogo.src = "";
    }

    function countChannelsInCategory(category) {
      return channels.filter(channel => channel.category === category).length;
    }

    function handleFileUpload(event) {
      clearData();
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const content = e.target.result;
          data = content;
          channels = parseM3U(data);
          const categories = Array.from(new Set(channels.map(channel => channel.category)));
          categories.forEach(category => {
            const option = document.createElement("option");
            option.value = category;
            option.textContent = `${category} (${countChannelsInCategory(category)})`;
            categorySelect.appendChild(option);
          });
          updateChannelSelect();
        };
        reader.readAsText(file);
      }
    }

    function playChannel() {
      const selectedChannelUrl = channelLinkInput.value; // L·∫•y li√™n k·∫øt t·ª´ channelLinkInput
      // C·∫≠p nh·∫≠t tr√¨nh ph√°t video
      videoPlayer.src({
        src: selectedChannelUrl,
        type: "application/x-mpegURL"
      });
      // L·∫•y k√™nh ƒë√£ ch·ªçn t·ª´ channelSelect
      const selectedChannel = channels.find(channel => channel.url === channelSelect.value);
      // C·∫≠p nh·∫≠t logo k√™nh t·ª´ k√™nh ƒë√£ ch·ªçn
      if (selectedChannel) {
        channelLogo.src = selectedChannel.logo;
      } else {
        channelLogo.src = "";
      }
    }
    channelLinkInput.addEventListener("input", () => {
      playChannel();
    });
    // T·ª± ƒë·ªông ch·ªçn ngu·ªìn ƒë·∫ßu ti√™n v√† fetch d·ªØ li·ªáu khi m·ªü trang
    sourceSelect.selectedIndex = 0;
    sourceSelect.dispatchEvent(new Event("change"));
  </script>
<script src="https://vsalema.github.io/play3/js/play52.js"></script>
  </body>

</html>
  
  
  
